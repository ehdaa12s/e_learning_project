<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/student.css">
</head>
<body>

<h1>Welcome, <span id="studentName">Student</span>!</h1>

<h2>My Courses</h2>
<div id="myCoursesContainer" class="courses-grid"></div>

<script type="module">
import { auth, db } from "../js/firebase.js";
import { getDocs, collection, query, where, getDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

async function loadMyCourses(){
    const user = auth.currentUser;
    if(!user){
        window.location.href = '../login.html';
        return;
    }

    document.getElementById('studentName').textContent = user.displayName || user.email || 'Student';

    const q = query(collection(db, 'enrollments'), where('userId', '==', user.uid));
    const snap = await getDocs(q);
    const enrollments = snap.docs.map(d => ({ id: d.id, ...d.data() }));

    const container = document.getElementById('myCoursesContainer');
    if(enrollments.length === 0){
        container.innerHTML = '<p class="no-data">You have not enrolled in any courses yet.</p>';
        return;
    }

    const entries = [];
    for (const e of enrollments) {
        const cs = await getDoc(doc(db, 'courses', e.courseId));
        if (cs.exists()) entries.push({ course: { id: cs.id, ...cs.data() }, progress: e.progress || 0 });
    }

    container.innerHTML = entries.map(({ course, progress }) => `
        <div class="course-card">
            <h3>${course.title}</h3>
            <p>Instructor: ${course.instructor || 'Unknown'}</p>
            <p>Progress: ${progress}%</p>
            <a href="course-details.html?id=${course.id}" class="btn-primary">Continue Course</a>
        </div>
    `).join('');
}

loadMyCourses();
</script>
</body>
</html>
